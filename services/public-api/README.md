# public-api Service

This service acts as the public facing API for the entire application.

## Architecture

This service provides a GraphQL API built with [Apollo Server 3](https://www.apollographql.com/docs/apollo-server/) by default that will act as a central gateway for all requests.

If you need to provide REST Endpoints or callbacks endpoints, you can register them in the serverless.yml as well.

### Folder Structure

All Lambda handlers should be in the `handlers` folder with colocated test files. The `healtcheck` function provides an example of how to structure a standard handler with test. The `graphql` function provides the Apollo Server. You should only need to modify this file if you're changing core Apollo Server features.

Your GraphQL schema type definitions and resolvers should live in the `schema` folder. Each domain should have its own folder and contain the following files:

- `domain.typedefs.ts`
- `domain.resolvers.ts`
- `domain.test.ts`

The domain typedef and resolver should then be imported into `schema/index.ts` and registered to their respective export so they are properly loaded into the Apollo Server.

The `types` folder contains all the types needed for this service. A `graphql.d.ts` is autogenerated using [GraphQL CodeGen](https://www.graphql-code-generator.com/).

This service will host the primary API Gateway for the rest of the application so all public facing endpoints should be added to this service.

### Invoking other services in resolvers

Most of your resolvers will probably invoke lambdas in other services. You can achieve this by using the `invoke` helper function from the `shared` lib. Your invocation will take the shape of:

```ts
const data = await invoke({
  serviceName: 'name-of-serivce',
  functionName: 'function-you-want-to-invoke',
  payload: {
    // payload to send to the invoked function
  },
  context, // from the current request's context
});
```

## Restricting Endpoints

By default, all endpoints are public and unprotected from CORS. Before deploying to production or infrastucture, please read https://www.serverless.com/framework/docs/providers/aws/events/http-api/#cors-setup and set up CORS appropriately.

## Domain Configuration

TBD

## Scripts

`yarn deploy public-api`

This will run `sls deploy` for the service and will use the defaults assigned in your serverless.yml. If you need to send overrides to the deploy command, you can pass arguments to the command as follows:

```
yarn deploy public-api --args="-region us-east-1 -stage prod"
```
